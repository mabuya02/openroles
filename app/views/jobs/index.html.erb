<% content_for :title, "Browse Jobs - Find Your Next Opportunity" %>
<% content_for :description, "Explore thousands of job opportunities from top companies. Filter by location, salary, employment type, and skills to find your perfect match." %>

<!-- Hero Section -->
<div class="row mb-4">
  <div class="col-12">
    <div class="bg-primary-subtle rounded-3 p-4 text-center">
      <div class="d-inline-flex align-items-center justify-content-center bg-primary rounded-circle mb-3" style="width: 60px; height: 60px;">
        <i class="iconoir-search fs-3 text-white"></i>
      </div>
      <h2 class="fw-bold text-dark mb-2">Discover Your Dream Job</h2>
      <p class="text-muted mb-0 fs-16">Browse <%= @pagy ? @pagy.count : @jobs.size %> amazing opportunities from top companies</p>
    </div>
  </div>
</div>

    <!-- Advanced Search -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="card border-0 shadow-sm">
          <div class="card-body">
            <%= form_with url: search_jobs_path, method: :get, local: true, class: "row g-3" do |f| %>
              <div class="col-md-4">
                <div class="input-group">
                  <span class="input-group-text bg-light border-end-0">
                    <i class="iconoir-search text-muted"></i>
                  </span>
                  <%= f.text_field :q, placeholder: "Job title, keywords, or company", 
                      value: params[:q], class: "form-control border-start-0 ps-0", 
                      id: "job-search-input" %>
                </div>
              </div>
              <div class="col-md-3">
                <div class="input-group">
                  <span class="input-group-text bg-light border-end-0">
                    <i class="iconoir-pin-alt text-muted"></i>
                  </span>
                  <%= f.text_field :location, placeholder: "Location", 
                      value: params[:location], class: "form-control border-start-0 ps-0",
                      id: "location-search-input" %>
                </div>
              </div>
              <div class="col-md-2">
                <%= f.select :employment_type, 
                    options_for_select([
                      ['All Types', ''],
                      ['Full-time', EmploymentType::FULL_TIME],
                      ['Part-time', EmploymentType::PART_TIME],
                      ['Contract', EmploymentType::CONTRACT],
                      ['Freelance', EmploymentType::FREELANCE],
                      ['Internship', EmploymentType::INTERNSHIP]
                    ], params[:employment_type]),
                    {}, { class: "form-select" } %>
              </div>
              <div class="col-md-2">
                <%= f.select :has_salary,
                    options_for_select([
                      ['All Salaries', ''],
                      ['With Salary', 'true']
                    ], params[:has_salary]),
                    {}, { class: "form-select" } %>
              </div>
              <div class="col-md-1">
                <%= f.submit "Search", class: "btn btn-primary w-100" %>
              </div>
              <div class="col-12">
                <div class="d-flex justify-content-center mt-3">
                  <%= link_to jobs_path, class: "btn btn-outline-secondary btn-sm", data: { turbo: false } do %>
                    <i class="iconoir-refresh me-1"></i>Clear All
                  <% end %>
                </div>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>

    <!-- Jobs List -->
    <div class="row">
      <div class="col-12">
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-white border-bottom">
              <div class="d-flex align-items-center justify-content-between">
                <h5 class="card-title mb-0 d-flex align-items-center">
                  <i class="iconoir-briefcase me-2 text-primary"></i>
                  <%= @pagy ? "#{@pagy.count} Jobs Found" : "Latest Jobs" %>
                </h5>
                <div class="flex-shrink-0">
                  <select class="form-select form-select-sm border-0 bg-light" id="sort-select">
                    <option value="newest">Newest First</option>
                    <option value="oldest">Oldest First</option>
                    <option value="salary-high">Salary: High to Low</option>
                    <option value="salary-low">Salary: Low to High</option>
                  </select>
                </div>
              </div>
            </div>
            <div class="card-body p-0">
              <% if @jobs.present? %>
                <% @jobs.each_with_index do |job, index| %>
                  <div class="job-item border-bottom position-relative" data-job-id="<%= job.id %>">
                    <div class="p-4 hover-bg-light">
                      <div class="row align-items-center">
                        <div class="col-md-8">
                          <div class="d-flex align-items-start">
                            <div class="flex-shrink-0 me-3">
                              <div class="d-inline-flex align-items-center justify-content-center bg-primary-subtle rounded-3" style="width: 48px; height: 48px;">
                                <i class="iconoir-<%= job.remote_friendly? ? 'wifi' : 'building' %> fs-4 text-primary"></i>
                              </div>
                            </div>
                            <div class="flex-grow-1">
                              <h5 class="fs-16 mb-2">
                                <%= link_to job.title, job_path(job), 
                                    class: "text-dark text-decoration-none job-title-link",
                                    data: { turbo: false } %>
                                <% if job.remote_friendly? %>
                                  <span class="badge bg-success-subtle text-success ms-2">
                                    <i class="iconoir-wifi me-1"></i>Remote
                                  </span>
                                <% end %>
                              </h5>
                              <p class="text-muted mb-2 d-flex align-items-center">
                                <i class="iconoir-building me-1"></i>
                                <%= link_to job.company.name, company_path(job.company), 
                                    class: "text-primary text-decoration-none fw-medium me-2",
                                    data: { turbo: false } %>
                                <% if job.location.present? %>
                                  <span class="mx-1">â€¢</span>
                                  <i class="iconoir-pin-alt me-1"></i>
                                  <span><%= job.location %></span>
                                <% end %>
                              </p>
                              <div class="d-flex flex-wrap gap-2 mb-2">
                                <span class="badge bg-primary-subtle text-primary">
                                  <i class="iconoir-clock me-1"></i>
                                  <%= job.employment_type&.humanize || 'Full-time' %>
                                </span>
                                <% if job.salary_min.present? || job.salary_max.present? %>
                                  <span class="badge bg-success-subtle text-success">
                                    <i class="iconoir-dollar me-1"></i>
                                    <% if job.salary_min && job.salary_max %>
                                      $<%= number_with_delimiter(job.salary_min) %> - $<%= number_with_delimiter(job.salary_max) %>
                                    <% elsif job.salary_min %>
                                      From $<%= number_with_delimiter(job.salary_min) %>
                                    <% elsif job.salary_max %>
                                      Up to $<%= number_with_delimiter(job.salary_max) %>
                                    <% end %>
                                  </span>
                                <% end %>
                                <% if job.tags.any? %>
                                  <% job.tags.limit(3).each do |tag| %>
                                    <span class="badge bg-secondary-subtle text-secondary">
                                      <i class="iconoir-tag me-1"></i>
                                      <%= tag.name %>
                                    </span>
                                  <% end %>
                                  <% if job.tags.count > 3 %>
                                    <span class="badge bg-light text-muted">
                                      +<%= job.tags.count - 3 %> more
                                    </span>
                                  <% end %>
                                <% end %>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="col-md-4 text-md-end">
                          <p class="text-muted mb-3 fs-13">
                            <i class="iconoir-clock me-1"></i>
                            <%= time_ago_in_words(job.created_at) %> ago
                          </p>
                          <div class="d-flex flex-md-column flex-row gap-2 justify-content-md-end">
                            <%= link_to job_path(job), 
                                class: "btn btn-primary btn-sm",
                                data: { turbo: false } do %>
                              <i class="iconoir-eye me-1"></i>View Job
                            <% end %>
                            <% if job.apply_url.present? %>
                              <%= link_to job.apply_url, 
                                  class: "btn btn-outline-success btn-sm",
                                  target: "_blank", rel: "noopener" do %>
                                <i class="iconoir-open-select-hand-gesture me-1"></i>Apply Now
                              <% end %>
                            <% end %>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                <% end %>
              <% else %>
                <div class="text-center py-5">
                  <div class="d-inline-flex align-items-center justify-content-center bg-light rounded-circle mb-4" style="width: 80px; height: 80px;">
                    <i class="iconoir-search fs-1 text-muted"></i>
                  </div>
                  <h5 class="mb-3">No Jobs Found</h5>
                  <p class="text-muted mb-4">
                    We couldn't find any jobs matching your criteria. Try adjusting your search filters.
                  </p>
                  <%= link_to jobs_path, class: "btn btn-primary", data: { turbo: false } do %>
                    <i class="iconoir-refresh me-1"></i>Browse All Jobs
                  <% end %>
                </div>
              <% end %>
            </div>
          </div>
        </div>
        
        <!-- Pagination -->
        <% if defined?(@pagy) && @pagy %>
          <div class="text-center mt-4">
            <%== pagy_bootstrap_nav_no_turbo(@pagy) %>
          </div>
        <% end %>
      </div>
    </div>
</div>

<style>
  .hover-bg-light:hover {
    background-color: rgba(0, 123, 255, 0.02) !important;
    transition: background-color 0.2s ease;
  }
  
  .job-title-link:hover {
    color: var(--bs-primary) !important;
  }
  
  .job-item {
    transition: all 0.2s ease;
  }
  
  .job-item:hover {
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }
</style>

