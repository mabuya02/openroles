<% content_for :title, "Edit Profile" %>

<div class="container-fluid">
  <div class="row">
    <div class="col-12">
      <div class="page-title-box d-sm-flex align-items-center justify-content-between">
        <h4 class="mb-sm-0">
          <i class="iconoir-edit-pencil me-2"></i>Edit Profile
        </h4>
        <div class="page-title-right">
          <%= link_to profile_path, class: "btn btn-secondary", data: { turbo: false } do %>
            <i class="iconoir-arrow-left me-1"></i>Back to Profile
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <!-- Flash Messages -->
  <% if flash[:error] %>
    <div class="row">
      <div class="col-12">
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
          <i class="iconoir-warning-triangle me-1"></i><%= flash[:error] %>
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      </div>
    </div>
  <% end %>

  <% if flash[:success] %>
    <div class="row">
      <div class="col-12">
        <div class="alert alert-success alert-dismissible fade show" role="alert">
          <i class="iconoir-check me-1"></i><%= flash[:success] %>
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      </div>
    </div>
  <% end %>

  <form action="<%= profile_path %>" method="post" enctype="multipart/form-data" id="profile-form" data-turbo="false">
    <%= hidden_field_tag :authenticity_token, form_authenticity_token %>
    <%= hidden_field_tag :_method, 'patch' %>
    
    <!-- Error Messages -->
    <% if @user_profile.errors.any? %>
      <div class="row">
        <div class="col-12">
          <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <h6><i class="iconoir-warning-triangle me-1"></i>Please fix the following errors:</h6>
            <ul class="mb-0">
              <% @user_profile.errors.full_messages.each do |message| %>
                <li><%= message %></li>
              <% end %>
            </ul>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        </div>
      </div>
    <% end %>
    
    <div class="row">
      <!-- Basic Information -->
      <div class="col-xl-6">
        <div class="card">
          <div class="card-header">
            <h5 class="card-title mb-0">
              <i class="iconoir-user me-2"></i>Basic Information
            </h5>
          </div>
          <div class="card-body">
            <div class="mb-3">
              <label for="user_profile_bio" class="form-label">
                <i class="iconoir-text me-1"></i>Bio
              </label>
              <%= text_area_tag "user_profile[bio]", @user_profile.bio, class: "form-control", rows: 4, placeholder: "Tell us about yourself..." %>
            </div>

            <div class="mb-3">
              <label for="user_profile_skills" class="form-label">
                <i class="iconoir-brain me-1"></i>Skills
              </label>
              <%= text_area_tag "user_profile[skills]", @user_profile.skills, class: "form-control", rows: 3, placeholder: "List your skills, separated by commas..." %>
              <div class="form-text">e.g. JavaScript, Python, React, Node.js</div>
            </div>
          </div>
        </div>

        <!-- Contact Links -->
        <div class="card">
          <div class="card-header">
            <h5 class="card-title mb-0">
              <i class="iconoir-link me-2"></i>Professional Links
            </h5>
          </div>
          <div class="card-body">
            <div class="mb-3">
              <label for="user_profile_portfolio_url" class="form-label">
                <i class="iconoir-internet me-1"></i>Portfolio Website
              </label>
              <%= url_field_tag "user_profile[portfolio_url]", @user_profile.portfolio_url, class: "form-control", placeholder: "https://your-portfolio.com" %>
            </div>

            <div class="mb-3">
              <label for="user_profile_linkedin_url" class="form-label">
                <i class="iconoir-linkedin me-1"></i>LinkedIn Profile
              </label>
              <%= url_field_tag "user_profile[linkedin_url]", @user_profile.linkedin_url, class: "form-control", placeholder: "https://linkedin.com/in/username" %>
            </div>

            <div class="mb-3">
              <label for="user_profile_github_url" class="form-label">
                <i class="iconoir-github me-1"></i>GitHub Profile
              </label>
              <%= url_field_tag "user_profile[github_url]", @user_profile.github_url, class: "form-control", placeholder: "https://github.com/username" %>
            </div>
          </div>
        </div>
      </div>

      <!-- Profile Documents -->
      <div class="col-xl-6">
        <div class="card">
          <div class="card-header">
            <h5 class="card-title mb-0">
              <i class="iconoir-folder me-2"></i>Profile Documents
            </h5>
          </div>
          <div class="card-body">
            <div class="mb-3">
              <label for="user_profile_profile_picture" class="form-label">Profile Picture</label>
              <%= file_field_tag "user_profile[profile_picture]", class: "form-control", accept: "image/*" %>
              <% if @user_profile.profile_picture.attached? %>
                <div class="mt-2 p-3 border rounded bg-light">
                  <div class="d-flex align-items-center">
                    <i class="iconoir-media-image me-2 text-primary"></i>
                    <span class="text-muted"><%= @user_profile.profile_picture.filename %></span>
                    <small class="text-muted ms-2">(Delete from profile page)</small>
                  </div>
                </div>
              <% end %>
            </div>

            <div class="mb-3">
              <label for="user_profile_resume" class="form-label">Resume</label>
              <%= file_field_tag "user_profile[resume]", class: "form-control", accept: ".pdf,.doc,.docx" %>
              <% if @user_profile.resume.attached? %>
                <div class="mt-2 p-3 border rounded bg-light">
                  <div class="d-flex align-items-center">
                    <i class="iconoir-page me-2 text-primary"></i>
                    <span class="text-muted"><%= @user_profile.resume.filename %></span>
                    <small class="text-muted ms-2">(Delete from profile page)</small>
                  </div>
                </div>
              <% end %>
            </div>

            <div class="mb-3">
              <label for="user_profile_portfolio_files" class="form-label">Portfolio Files</label>
              <%= file_field_tag "user_profile[portfolio_files][]", class: "form-control", multiple: true, accept: ".pdf,.jpg,.jpeg,.png,.zip" %>
              <div class="form-text">Upload portfolio files (multiple files allowed)</div>
              <% if @user_profile.portfolio_files.any? %>
                <div class="mt-2">
                  <label class="form-label small text-muted">Current files:</label>
                  <% @user_profile.portfolio_files.each do |file| %>
                    <div class="p-2 border rounded bg-light mb-2">
                      <div class="d-flex align-items-center justify-content-between">
                        <div class="d-flex align-items-center">
                          <i class="iconoir-folder me-2 text-primary"></i>
                          <span class="text-muted"><%= file.filename %></span>
                          <small class="text-muted ms-2">(Delete from profile page)</small>
                        </div>
                      </div>
                    </div>
                  <% end %>
                </div>
              <% end %>
            </div>

            <div class="mb-3">
              <label for="user_profile_certificates" class="form-label">Certificates</label>
              <%= file_field_tag "user_profile[certificates][]", class: "form-control", multiple: true, accept: ".pdf,.jpg,.jpeg,.png" %>
              <div class="form-text">Upload certificates (multiple files allowed)</div>
              <% if @user_profile.certificates.any? %>
                <div class="mt-2">
                  <label class="form-label small text-muted">Current certificates:</label>
                  <% @user_profile.certificates.each do |file| %>
                    <div class="p-2 border rounded bg-light mb-2">
                      <div class="d-flex align-items-center">
                        <i class="iconoir-folder me-2 text-primary"></i>
                        <span class="text-muted"><%= file.filename %></span>
                        <small class="text-muted ms-2">(Delete from profile page)</small>
                      </div>
                    </div>
                  <% end %>
                </div>
              <% end %>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Submit Button -->
    <div class="row">
      <div class="col-12">
        <div class="card">
          <div class="card-body">
            <div class="d-flex justify-content-end gap-2">
              <%= link_to profile_path, class: "btn btn-secondary", data: { turbo: false } do %>
                <i class="iconoir-cancel me-1"></i>Cancel
              <% end %>
              <button type="submit" class="btn btn-primary">
                <i class="iconoir-check me-1"></i>Update Profile
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </form>
</div>
