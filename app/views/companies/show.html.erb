<% content_for :title, "#{@company.name} - Company Profile" %>
<% content_for :description, "Learn more about #{@company.name}, explore their job opportunities and company culture. #{@company.industry.present? ? "Industry: #{@company.industry}." : ""}" %>

<!-- Breadcrumb -->
<div class="row">
  <div class="col-12">
    <div class="page-title-box d-sm-flex align-items-center justify-content-between">
      <h4 class="mb-sm-0 font-size-18"><%= @company.name %></h4>
      <div class="page-title-right">
        <ol class="breadcrumb m-0">
          <li class="breadcrumb-item"><%= link_to "Home", root_path, data: { turbo: false } %></li>
          <li class="breadcrumb-item"><%= link_to "Companies", companies_path, data: { turbo: false } %></li>
          <li class="breadcrumb-item active"><%= truncate(@company.name, length: 30) %></li>
        </ol>
      </div>
    </div>
  </div>
</div>

<!-- Company Header -->
<div class="row">
  <div class="col-12">
    <div class="card border-0 shadow-sm mb-4">
      <div class="card-body p-4">
        <div class="row align-items-center">
          <div class="col-md-8">
            <div class="d-flex align-items-center mb-3">
              <div class="avatar-lg me-4">
                <% if @company.logo_url.present? %>
                  <%= image_tag @company.logo_url, alt: @company.name, class: "rounded-3 img-fluid", style: "width: 64px; height: 64px; object-fit: cover;" %>
                <% else %>
                  <div class="avatar-title bg-light text-primary rounded-3 fs-1">
                    <i class="iconoir-building"></i>
                  </div>
                <% end %>
              </div>
              <div>
                <h1 class="mb-2 fs-24 fw-bold"><%= @company.name %></h1>
                <% if @company.industry.present? %>
                  <p class="text-muted mb-1 fs-15">
                    <i class="iconoir-category me-1"></i>
                    <%= @company.industry %>
                  </p>
                <% end %>
                <% if @company.location.present? %>
                  <p class="text-muted mb-0 fs-15">
                    <i class="iconoir-map-pin me-1"></i>
                    <%= @company.location %>
                  </p>
                <% end %>
              </div>
            </div>
            
            <% if @company.website.present? %>
              <div class="d-flex gap-3 mb-3">
                <%= link_to @company.website, target: "_blank", rel: "noopener", class: "btn btn-outline-primary" do %>
                  <i class="iconoir-internet me-1"></i>Visit Website
                <% end %>
              </div>
            <% end %>
          </div>
          
          <div class="col-md-4">
            <!-- Company Stats -->
            <% if defined?(@company_stats) && @company_stats %>
              <div class="row text-center">
                <div class="col-6">
                  <h4 class="fw-bold text-primary mb-0">
                    <%= @company_stats[:total_jobs] || @company.jobs.published.count %>
                  </h4>
                  <p class="text-muted mb-2 fs-13">Open Jobs</p>
                </div>
                <div class="col-6">
                  <h4 class="fw-bold text-success mb-0">
                    <%= @company_stats[:remote_jobs] || @company.jobs.published.select(&:remote_friendly?).count %>
                  </h4>
                  <p class="text-muted mb-0 fs-13">Remote Jobs</p>
                </div>
              </div>
            <% else %>
              <div class="row text-center">
                <div class="col-6">
                  <h4 class="fw-bold text-primary mb-0">
                    <%= @company.jobs.published.count %>
                  </h4>
                  <p class="text-muted mb-2 fs-13">Open Jobs</p>
                </div>
                <div class="col-6">
                  <h4 class="fw-bold text-success mb-0">
                    <%= @company.jobs.published.select(&:remote_friendly?).count %>
                  </h4>
                  <p class="text-muted mb-0 fs-13">Remote Jobs</p>
                </div>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Company Details Section -->
<div class="row mb-4">
  <div class="col-12">
    <div class="card border-0 shadow-sm">
      <div class="card-header bg-white border-bottom">
        <h5 class="card-title mb-0">
          <i class="iconoir-info-circle me-2 text-primary"></i>
          Company Information
        </h5>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-md-6">
            <div class="company-info-item mb-3">
              <h6 class="text-muted mb-2 fs-14 fw-medium">COMPANY NAME</h6>
              <p class="mb-0 fs-15"><%= @company.name %></p>
            </div>
            
            <% if @company.industry.present? %>
              <div class="company-info-item mb-3">
                <h6 class="text-muted mb-2 fs-14 fw-medium">INDUSTRY</h6>
                <p class="mb-0 fs-15">
                  <span class="badge bg-primary-subtle text-primary fs-13">
                    <%= @company.industry.humanize %>
                  </span>
                </p>
              </div>
            <% end %>

            <% if @company.location.present? %>
              <div class="company-info-item mb-3">
                <h6 class="text-muted mb-2 fs-14 fw-medium">LOCATION</h6>
                <p class="mb-0 fs-15">
                  <i class="iconoir-map-pin me-1 text-muted"></i>
                  <%= @company.location %>
                </p>
              </div>
            <% end %>
          </div>

          <div class="col-md-6">
            <% if @company.website.present? %>
              <div class="company-info-item mb-3">
                <h6 class="text-muted mb-2 fs-14 fw-medium">WEBSITE</h6>
                <p class="mb-0 fs-15">
                  <%= link_to @company.website, @company.website, target: "_blank", rel: "noopener", class: "text-primary text-decoration-none" do %>
                    <i class="iconoir-internet me-1"></i>
                    <%= @company.website.gsub(%r{https?://}, '') %>
                    <i class="iconoir-arrow-up-right ms-1 fs-12"></i>
                  <% end %>
                </p>
              </div>
            <% end %>

            <div class="company-info-item mb-3">
              <h6 class="text-muted mb-2 fs-14 fw-medium">COMPANY STATUS</h6>
              <p class="mb-0 fs-15">
                <span class="badge bg-success-subtle text-success fs-13">
                  <i class="iconoir-check-circle me-1"></i>
                  <%= @company.status.humanize %>
                </span>
              </p>
            </div>

            <div class="company-info-item mb-3">
              <h6 class="text-muted mb-2 fs-14 fw-medium">MEMBER SINCE</h6>
              <p class="mb-0 fs-15">
                <i class="iconoir-calendar me-1 text-muted"></i>
                <%= @company.created_at.strftime("%B %Y") %>
              </p>
            </div>
          </div>
        </div>

        <!-- Company Statistics Row -->
        <div class="row mt-4 pt-3 border-top">
          <div class="col-12">
            <h6 class="text-muted mb-3 fs-14 fw-medium">COMPANY STATISTICS</h6>
          </div>
          <div class="col-md-3 col-6 mb-3">
            <div class="text-center p-3 bg-light rounded">
              <h4 class="fw-bold text-primary mb-1">
                <%= @company.jobs.count %>
              </h4>
              <p class="text-muted mb-0 fs-13">Total Jobs Posted</p>
            </div>
          </div>
          <div class="col-md-3 col-6 mb-3">
            <div class="text-center p-3 bg-light rounded">
              <h4 class="fw-bold text-success mb-1">
                <%= @company.jobs.published.count %>
              </h4>
              <p class="text-muted mb-0 fs-13">Active Job Openings</p>
            </div>
          </div>
          <div class="col-md-3 col-6 mb-3">
            <div class="text-center p-3 bg-light rounded">
              <h4 class="fw-bold text-info mb-1">
                <%= @company.jobs.published.select(&:remote_friendly?).count %>
              </h4>
              <p class="text-muted mb-0 fs-13">Remote Positions</p>
            </div>
          </div>
          <div class="col-md-3 col-6 mb-3">
            <div class="text-center p-3 bg-light rounded">
              <h4 class="fw-bold text-warning mb-1">
                <%= (@company.updated_at > 30.days.ago) ? "Recently" : "Not Recent" %>
              </h4>
              <p class="text-muted mb-0 fs-13">Last Updated</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Jobs and Company Info -->
<div class="row">
  <!-- Company Jobs -->
  <div class="col-lg-8">
    <div class="card border-0 shadow-sm mb-4">
      <div class="card-header bg-white border-bottom">
        <div class="d-flex align-items-center justify-content-between">
          <h5 class="card-title mb-0">
            <i class="iconoir-suitcase me-2 text-primary"></i>
            Open Positions
          </h5>
          <% if @company.jobs.published.count > 0 %>
            <%= link_to jobs_company_path(@company), class: "btn btn-outline-primary btn-sm", data: { turbo: false } do %>
              View All Jobs <i class="iconoir-arrow-right ms-1"></i>
            <% end %>
          <% end %>
        </div>
      </div>
      <div class="card-body p-0">
        <% if @company_jobs.present? %>
          <% @company_jobs.each_with_index do |job, index| %>
            <div class="p-4 <%= 'border-bottom' if index < @company_jobs.size - 1 %> hover-bg-light">
              <div class="row align-items-center">
                <div class="col-md-8">
                  <h6 class="mb-2">
                    <%= link_to job.title, job_path(job), class: "text-dark text-decoration-none fw-medium", data: { turbo: false } %>
                    <% if job.remote_friendly? %>
                      <span class="badge bg-success-subtle text-success ms-2">
                        <i class="iconoir-wifi me-1"></i>Remote
                      </span>
                    <% end %>
                  </h6>
                  <div class="d-flex flex-wrap gap-3 text-muted fs-13">
                    <% if job.employment_type.present? %>
                      <span><i class="iconoir-timer me-1"></i><%= job.employment_type.humanize %></span>
                    <% end %>
                    <% if job.location.present? %>
                      <span><i class="iconoir-map-pin me-1"></i><%= job.location %></span>
                    <% end %>
                    <span><i class="iconoir-clock me-1"></i><%= time_ago_in_words(job.created_at) %> ago</span>
                  </div>
                </div>
                <div class="col-md-4 text-md-end">
                  <div class="d-flex flex-md-column flex-row gap-2 justify-content-md-end">
                    <%= link_to job_path(job), class: "btn btn-primary btn-sm", data: { turbo: false } do %>
                      <i class="iconoir-eye me-1"></i>View Job
                    <% end %>
                  </div>
                </div>
              </div>
            </div>
          <% end %>
          
          <!-- Pagination -->
          <% if defined?(@pagy) && @pagy && @pagy.pages > 1 %>
            <div class="p-4 border-top">
              <div class="text-center">
                <%== pagy_bootstrap_nav_no_turbo(@pagy) %>
              </div>
            </div>
          <% end %>
        <% else %>
          <div class="text-center py-5">
            <div class="avatar-lg mx-auto mb-4">
              <div class="avatar-title bg-light text-muted rounded-circle fs-1">
                <i class="iconoir-briefcase"></i>
              </div>
            </div>
            <h6 class="mb-3">No Open Positions</h6>
            <p class="text-muted mb-4">
              <%= @company.name %> doesn't have any open positions at the moment. Check back later for new opportunities.
            </p>
            <%= link_to companies_path, class: "btn btn-primary", data: { turbo: false } do %>
              <i class="iconoir-building me-1"></i>Browse Other Companies
            <% end %>
          </div>
        <% end %>
      </div>
    </div>

    <!-- Similar Companies Grid -->
    <% if defined?(@similar_companies) && @similar_companies.present? %>
      <div class="card border-0 shadow-sm">
        <div class="card-header bg-white border-bottom">
          <h5 class="card-title mb-0">
            <i class="iconoir-building me-2 text-primary"></i>
            Similar Companies
          </h5>
        </div>
        <div class="card-body">
          <div class="row g-3">
            <% @similar_companies.each do |company| %>
              <div class="col-md-6">
                <div class="p-3 border rounded hover-bg-light h-100">
                  <div class="d-flex align-items-start">
                    <div class="avatar-md me-3 flex-shrink-0">
                      <% if company.logo_url.present? %>
                        <%= image_tag company.logo_url, alt: company.name, class: "rounded img-fluid", style: "width: 48px; height: 48px; object-fit: cover;" %>
                      <% else %>
                        <div class="avatar-title bg-light text-primary rounded fs-20">
                          <i class="iconoir-building m3 2"></i>
                        </div>
                      <% end %>
                    </div>
                    <div class="flex-grow-1 min-w-0">
                      <h6 class="mb-1 fs-15 fw-medium">
                        <%= link_to company.name, company_path(company), class: "text-dark text-decoration-none text-truncate d-block", data: { turbo: false } %>
                      </h6>
                      <p class="text-muted mb-2 fs-13">
                        <i class="iconoir-briefcase me-1"></i>
                        <%= pluralize(company.jobs.published.count, 'job') %>
                        <% if company.industry.present? %>
                          <br><i class="iconoir-suitcase me-1"></i><%= company.industry %>
                        <% end %>
                      </p>
                      <% if company.location.present? %>
                        <p class="text-muted mb-0 fs-12">
                          <i class="iconoir-map-pin me-1"></i>
                          <%= company.location %>
                        </p>
                      <% end %>
                    </div>
                  </div>
                </div>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>
  </div>
  
  <!-- Company Sidebar -->
  <div class="col-lg-4">


    <!-- Recent Job Postings -->
    <div class="card border-0 shadow-sm mb-4">
      <div class="card-header bg-white border-bottom">
        <h6 class="card-title mb-0">
          <i class="iconoir-clock me-1 text-primary"></i>
          Recent Job Postings
        </h6>
      </div>
      <div class="card-body p-0">
        <% recent_jobs = @company.jobs.published.order(created_at: :desc).limit(5) %>
        <% if recent_jobs.any? %>
          <% recent_jobs.each_with_index do |job, index| %>
            <div class="p-3 <%= 'border-bottom' if index < recent_jobs.size - 1 %> hover-bg-light">
              <div class="d-flex justify-content-between align-items-start mb-2">
                <h6 class="mb-1 fs-14 fw-medium">
                  <%= link_to job.title, job_path(job), class: "text-dark text-decoration-none", data: { turbo: false } %>
                </h6>
                <% if job.remote_friendly? %>
                  <span class="badge bg-success-subtle text-success fs-12">
                    <i class="iconoir-wifi"></i>
                  </span>
                <% end %>
              </div>
              <div class="text-muted fs-13 mb-2">
                <% if job.employment_type.present? %>
                  <i class="iconoir-timer me-1"></i><%= job.employment_type.humanize %>
                <% end %>
                <% if job.location.present? %>
                  <br><i class="iconoir-map-pin me-1"></i><%= job.location %>
                <% end %>
              </div>
              <div class="d-flex justify-content-between align-items-center">
                <small class="text-muted">
                  <i class="iconoir-calendar me-1"></i>
                  <%= time_ago_in_words(job.created_at) %> ago
                </small>
                <%= link_to job_path(job), class: "btn btn-outline-primary btn-sm", data: { turbo: false } do %>
                  <i class="iconoir-eye me-1"></i>View
                <% end %>
              </div>
            </div>
          <% end %>
          
          <% if @company.jobs.published.count > 5 %>
            <div class="p-3 text-center border-top bg-light">
              <%= link_to jobs_company_path(@company), class: "btn btn-primary btn-sm", data: { turbo: false } do %>
                <i class="iconoir-briefcase me-1"></i>
                View All <%= @company.jobs.published.count %> Jobs
              <% end %>
            </div>
          <% end %>
        <% else %>
          <div class="text-center py-4">
            <div class="avatar-md mx-auto mb-3">
              <div class="avatar-title bg-light text-muted rounded-circle">
                <i class="iconoir-briefcase"></i>
              </div>
            </div>
            <p class="text-muted mb-0 fs-14">No recent job postings</p>
          </div>
        <% end %>
      </div>
    </div>

    <!-- Company Quick Info -->
    <div class="card border-0 shadow-sm mb-4">
      <div class="card-header bg-white border-bottom">
        <h6 class="card-title mb-0">
          <i class="iconoir-info-circle me-1 text-primary"></i>
          Quick Info
        </h6>
      </div>
      <div class="card-body">
        <div class="quick-info-item mb-3">
          <div class="d-flex justify-content-between align-items-center">
            <span class="fs-14 text-muted">Industry</span>
            <% if @company.industry.present? %>
              <span class="badge bg-primary-subtle text-primary fs-13">
                <%= @company.industry.humanize %>
              </span>
            <% else %>
              <span class="text-muted fs-13">Not specified</span>
            <% end %>
          </div>
        </div>

        <div class="quick-info-item mb-3">
          <div class="d-flex justify-content-between align-items-center">
            <span class="fs-14 text-muted">Location</span>
            <span class="fs-13">
              <% if @company.location.present? %>
                <i class="iconoir-map-pin me-1"></i><%= @company.location %>
              <% else %>
                <span class="text-muted">Not specified</span>
              <% end %>
            </span>
          </div>
        </div>

        <div class="quick-info-item mb-3">
          <div class="d-flex justify-content-between align-items-center">
            <span class="fs-14 text-muted">Total Jobs</span>
            <span class="fw-bold text-primary fs-14"><%= @company.jobs.count %></span>
          </div>
        </div>

        <div class="quick-info-item mb-3">
          <div class="d-flex justify-content-between align-items-center">
            <span class="fs-14 text-muted">Active Jobs</span>
            <span class="fw-bold text-success fs-14"><%= @company.jobs.published.count %></span>
          </div>
        </div>

        <div class="quick-info-item mb-3">
          <div class="d-flex justify-content-between align-items-center">
            <span class="fs-14 text-muted">Remote Jobs</span>
            <span class="fw-bold text-info fs-14"><%= @company.jobs.published.select(&:remote_friendly?).count %></span>
          </div>
        </div>

        <div class="quick-info-item mb-0">
          <div class="d-flex justify-content-between align-items-center">
            <span class="fs-14 text-muted">Member Since</span>
            <span class="fs-13">
              <i class="iconoir-calendar me-1"></i>
              <%= @company.created_at.strftime("%b %Y") %>
            </span>
          </div>
        </div>

        <% if @company.website.present? %>
          <div class="mt-4 pt-3 border-top">
            <%= link_to @company.website, target: "_blank", rel: "noopener", class: "btn btn-outline-primary btn-sm w-100" do %>
              <i class="iconoir-internet me-1"></i>Visit Company Website
            <% end %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>

<style>
  .hover-bg-light:hover {
    background-color: rgba(0, 123, 255, 0.02) !important;
    transition: background-color 0.2s ease;
  }
  
  .avatar-lg {
    width: 64px;
    height: 64px;
  }

  .avatar-md {
    width: 48px;
    height: 48px;
  }

  .avatar-xl {
    width: 80px;
    height: 80px;
  }
  
  .avatar-title {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .company-info-item {
    border-left: 3px solid #f8f9fa;
    padding-left: 15px;
    transition: border-color 0.3s ease;
  }

  .company-info-item:hover {
    border-left-color: #007bff;
  }

  .company-detail-item {
    padding-bottom: 12px;
    border-bottom: 1px solid #f8f9fa;
  }

  .company-detail-item:last-child {
    border-bottom: none;
    padding-bottom: 0;
  }

  .quick-info-item {
    padding: 8px 0;
    border-bottom: 1px solid #f8f9fa;
    transition: background-color 0.2s ease;
  }

  .quick-info-item:last-child {
    border-bottom: none;
  }

  .quick-info-item:hover {
    background-color: rgba(0, 123, 255, 0.02);
    border-radius: 4px;
    margin: 0 -8px;
    padding: 8px;
  }

  .card {
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }

  .card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1) !important;
  }

  .badge {
    font-weight: 500;
    padding: 6px 12px;
  }

  .company-stats .border-end {
    border-color: #e9ecef !important;
  }

  @media (max-width: 768px) {
    .company-info-item {
      margin-bottom: 20px;
    }
  }
</style>
