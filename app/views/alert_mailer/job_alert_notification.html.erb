<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>New Job Opportunities - OpenRoles</title>
  <style>
    body { font-family: 'Helvetica Neue', Arial, sans-serif; line-height: 1.6; color: #333; margin: 0; padding: 0; background-color: #f8f9fa; }
    .container { max-width: 600px; margin: 0 auto; background-color: white; }
    .header { background: linear-gradient(135deg, #007bff 0%, #0056b3 100%); padding: 30px 20px; text-align: center; }
    .header h1 { color: white; margin: 0; font-size: 28px; font-weight: 300; }
    .content { padding: 30px 20px; }
    .alert-info { background-color: #e3f2fd; padding: 20px; border-radius: 8px; margin-bottom: 30px; border-left: 4px solid #007bff; }
    .job-item { border: 1px solid #e9ecef; border-radius: 8px; padding: 20px; margin-bottom: 20px; background-color: #fff; }
    .job-title { font-size: 18px; font-weight: 600; color: #007bff; margin-bottom: 8px; }
    .job-company { font-size: 16px; font-weight: 500; color: #333; margin-bottom: 8px; }
    .job-details { font-size: 14px; color: #666; margin-bottom: 15px; }
    .job-description { font-size: 14px; color: #555; margin-bottom: 15px; line-height: 1.5; }
    .job-actions { text-align: right; }
    .btn { display: inline-block; padding: 10px 20px; background-color: #007bff; color: white; text-decoration: none; border-radius: 5px; font-size: 14px; font-weight: 500; }
    .btn:hover { background-color: #0056b3; }
    .footer { background-color: #f8f9fa; padding: 20px; text-align: center; font-size: 12px; color: #666; }
    .unsubscribe { margin-top: 20px; font-size: 12px; color: #666; }
    .unsubscribe a { color: #666; }
    .stats { display: flex; justify-content: space-around; margin: 20px 0; }
    .stat-item { text-align: center; }
    .stat-number { font-size: 24px; font-weight: bold; color: #007bff; }
    .stat-label { font-size: 12px; color: #666; }
    .badge { display: inline-block; padding: 4px 8px; background-color: #28a745; color: white; font-size: 12px; border-radius: 12px; margin-left: 8px; }
    .remote-badge { background-color: #28a745; }
    .location-badge { background-color: #6c757d; }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <h1>üéØ New Job Opportunities</h1>
      <p style="color: #e3f2fd; margin: 10px 0 0 0;">Your personalized job matches</p>
    </div>

    <!-- Content -->
    <div class="content">
      <!-- Alert Info -->
      <div class="alert-info">
        <h3 style="margin-top: 0; color: #007bff;">Hi <%= @user.first_name %>!</h3>
        <p style="margin: 0;">
          We found <strong><%= pluralize(@matching_jobs.count, 'new job') %></strong> matching your alert criteria:
          <% if @alert.criteria["natural_query"].present? %>
            "<em><%= @alert.criteria["natural_query"] %></em>"
          <% else %>
            Your custom job preferences
          <% end %>
        </p>
      </div>

      <!-- Job Stats -->
      <div class="stats">
        <div class="stat-item">
          <div class="stat-number"><%= @matching_jobs.count %></div>
          <div class="stat-label">New Jobs</div>
        </div>
        <div class="stat-item">
          <div class="stat-number"><%= @matching_jobs.map(&:company).uniq.count %></div>
          <div class="stat-label">Companies</div>
        </div>
        <div class="stat-item">
          <div class="stat-number"><%= @matching_jobs.count { |job| job.location&.downcase&.include?('remote') } %></div>
          <div class="stat-label">Remote</div>
        </div>
      </div>

      <!-- Job Listings -->
      <% @matching_jobs.each do |job| %>
        <div class="job-item">
          <div class="job-title">
            <%= job.title %>
            <% if job.location.downcase.include?('remote') %>
              <span class="badge remote-badge">Remote</span>
            <% end %>
            <% if job.employment_type.present? %>
              <span class="badge location-badge"><%= job.employment_type.humanize %></span>
            <% end %>
          </div>
          <div class="job-company">
            üì¢ <%= job.company.name %>
            <% if job.company.industry.present? %>
              ‚Ä¢ <%= job.company.industry.humanize %>
            <% end %>
          </div>
          <div class="job-details">
            <% if job.location.present? %>
              üìç <%= job.location %>
            <% end %>
            <% if job.salary_min.present? || job.salary_max.present? %>
              ‚Ä¢ üí∞ 
              <% if job.salary_min.present? && job.salary_max.present? %>
                <%= number_to_currency(job.salary_min, precision: 0) %> - <%= number_to_currency(job.salary_max, precision: 0) %>
              <% elsif job.salary_min.present? %>
                From <%= number_to_currency(job.salary_min, precision: 0) %>
              <% elsif job.salary_max.present? %>
                Up to <%= number_to_currency(job.salary_max, precision: 0) %>
              <% end %>
            <% end %>
            ‚Ä¢ üìÖ Posted <%= time_ago_in_words(job.posted_at || job.created_at) %> ago
          </div>
          <% if job.description.present? %>
            <div class="job-description">
              <%= truncate(strip_tags(job.description), length: 200) %>
            </div>
          <% end %>
          <div class="job-actions">
            <a href="<%= job_url(job) %>" class="btn">View Job Details</a>
          </div>
        </div>
      <% end %>

      <!-- Call to Action -->
      <div style="text-align: center; margin: 30px 0;">
        <a href="<%= @alert_url %>" class="btn" style="margin-right: 10px;">Manage This Alert</a>
        <a href="<%= jobs_url %>" class="btn" style="background-color: #28a745;">Browse All Jobs</a>
      </div>
    </div>

    <!-- Footer -->
    <div class="footer">
      <p><strong>OpenRoles</strong> - Find your next opportunity</p>
      <p>This is your <strong><%= @alert.frequency %></strong> job alert. We'll keep you updated with the latest matches.</p>
      
      <div class="unsubscribe">
        <p>
          Don't want to receive these emails? 
          <a href="<%= @unsubscribe_url %>">Unsubscribe from this alert</a> | 
          <a href="<%= @alert_url %>">Update preferences</a>
        </p>
      </div>
    </div>
  </div>
</body>
</html>
