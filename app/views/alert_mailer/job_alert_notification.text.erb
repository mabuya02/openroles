🎯 NEW JOB OPPORTUNITIES

Hi <%= @user.first_name %>!

We found <%= pluralize(@matching_jobs.count, 'new job') %> matching your alert criteria:
<% if @alert.criteria["natural_query"].present? -%>
"<%= @alert.criteria["natural_query"] %>"
<% else -%>
Your custom job preferences
<% end -%>

📊 OVERVIEW:
• <%= @matching_jobs.count %> new jobs
• <%= @matching_jobs.map(&:company).uniq.count %> companies  
• <%= @matching_jobs.count { |job| job.location&.downcase&.include?('remote') } %> remote positions

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🔥 YOUR JOB MATCHES:

<% @matching_jobs.each_with_index do |job, index| -%>
<%= index + 1 %>. <%= job.title.upcase %>
   🏢 <%= job.company.name %><% if job.company.industry.present? %> • <%= job.company.industry.humanize %><% end %>
   📍 <%= job.location.present? ? job.location : 'Location not specified' %>
<% if job.employment_type.present? -%>
   💼 <%= job.employment_type.humanize %>
<% end -%>
<% if job.location&.downcase&.include?('remote') -%>
   📡 REMOTE POSITION
<% end -%>
<% if job.salary_min.present? || job.salary_max.present? -%>
   💰 <% if job.salary_min.present? && job.salary_max.present? -%>
<%= number_to_currency(job.salary_min, precision: 0) %> - <%= number_to_currency(job.salary_max, precision: 0) %>
<% elsif job.salary_min.present? -%>
From <%= number_to_currency(job.salary_min, precision: 0) %>
<% elsif job.salary_max.present? -%>
Up to <%= number_to_currency(job.salary_max, precision: 0) %>
<% end -%>
<% end -%>
   📅 Posted <%= time_ago_in_words(job.posted_at || job.created_at) %> ago
   
<% if job.description.present? -%>
   📝 <%= truncate(strip_tags(job.description), length: 120) %>
<% end -%>
<% if job.tags.any? -%>
   🏷️  Tags: <%= job.tags.limit(3).map(&:name).join(', ') %><% if job.tags.count > 3 %> (+<%= job.tags.count - 3 %> more)<% end %>
<% end -%>

   �️  VIEW: <%= job_url(job) %>
<% if job.apply_url.present? -%>
   ✋ APPLY: <%= job.apply_url %>
<% end -%>

   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

<% end -%>

🔧 MANAGE YOUR ALERTS:
• Manage this alert: <%= @alert_url %>
• Browse all jobs: <%= jobs_url %>
• Unsubscribe: <%= @unsubscribe_url %>

This is your <%= @alert.frequency %> job alert.
